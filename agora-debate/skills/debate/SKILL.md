---
name: debate
description: 주제 기반 다중 에이전트 토론 시뮬레이션을 실행합니다 (후속 토론 포함). Use when the user asks to "run a debate", "simulate a discussion", "토론 시뮬레이션", "다양한 관점으로 논의", or wants multi-agent debate on a topic. Supports topic argument and result file path for follow-up debates. Do NOT use for simple opinion questions, pros/cons lists, persuasive writing, or debate speech preparation.
compatibility: Requires Claude Code with Task (subagent) and AskUserQuestion tool support.
metadata:
  author: sjjang
  version: 0.2.0
  category: simulation
  tags: [debate, multi-agent, discussion, agora]
---

# Agora 토론 시뮬레이션

고대 그리스 아고라에서 영감을 받은 다중 에이전트 토론 시뮬레이션입니다.

> **아키텍처**: 각 토론자는 독립된 서브에이전트(개별 컨텍스트 윈도우)로 실행됩니다.
> 중재자(메인 대화)가 정보 흐름을 통제하여 **컨텍스트 오염을 방지**합니다.
> 중재자 역할 상세: `references/moderator.md` 참조

---

## 1단계: 진입점 분기

### result 인자가 있는 경우 → 후속 토론 모드
- Read 도구로 해당 파일 경로의 토론 결과를 읽는다
- **2단계(후속 토론)** 으로 진행

### topic 인자가 있는 경우 → 새 토론 모드
- 해당 주제로 토론 진행
- **3단계** 로 진행

### 인자가 없는 경우
- AskUserQuestion으로 모드 선택:
```yaml
questions:
  - header: "모드"
    question: "새 토론을 시작할까요, 기존 토론의 후속 토론을 할까요?"
    options:
      - label: "새 토론 (권장)"
        description: "새로운 주제로 토론을 시작합니다"
      - label: "후속 토론"
        description: "기존 토론 결과 파일을 기반으로 후속 토론합니다"
    multiSelect: false
```

#### "새 토론" 선택 시
- AskUserQuestion으로 주제 입력 요청:
```yaml
questions:
  - header: "주제"
    question: "토론할 주제를 입력해주세요"
    options:
      - label: "직접 입력"
        description: "토론 주제를 직접 입력합니다"
    multiSelect: false
```
- **3단계** 로 진행

#### "후속 토론" 선택 시
- AskUserQuestion으로 파일 경로 입력 요청:
```yaml
questions:
  - header: "결과 파일"
    question: "후속 토론할 원본 토론 결과 파일 경로를 입력해주세요"
    options:
      - label: "직접 입력"
        description: "토론 결과 파일 경로를 직접 입력합니다"
    multiSelect: false
```
- Read 도구로 파일 읽기
- **2단계(후속 토론)** 으로 진행

---

## 2단계: 후속 토론 준비 (후속 토론 모드만)

> 새 토론 모드에서는 이 단계를 건너뛰고 **3단계** 로 직행합니다.

### 2-1. 원본 토론 요약 출력
읽어온 원본 토론 결과에서 다음을 요약하여 사용자에게 출력:

```
📋 **원본 토론 요약**
- **주제**: [원본 주제]
- **합의 사항**: [합의 항목들]
- **미합의 사항**: [미합의 항목들]
- **주요 논쟁**: [핵심 쟁점들]
```

### 2-2. 후속 토론 초점 선택
```yaml
questions:
  - header: "초점"
    question: "후속 토론의 초점을 선택해주세요"
    options:
      - label: "미합의 사항 심화 (권장)"
        description: "원본의 미합의 항목에서 선택하여 심층 논의"
      - label: "합의 사항 재검토"
        description: "합의된 항목을 다른 관점에서 재논의"
      - label: "새 관련 주제"
        description: "원본에서 파생된 새 주제를 직접 입력"
    multiSelect: false
```

### 초점별 후속 처리

#### "미합의 사항 심화" 선택 시
원본의 미합의 사항 목록을 AskUserQuestion 옵션으로 제시:
```yaml
questions:
  - header: "미합의 선택"
    question: "심화 토론할 미합의 항목을 선택해주세요"
    options:
      # 원본 미합의 사항에서 최대 4개 동적 생성
      - label: "[미합의 항목 1]"
        description: "이 항목에 대해 심층 논의"
      - label: "[미합의 항목 2]"
        description: "이 항목에 대해 심층 논의"
    multiSelect: false
```

#### "합의 사항 재검토" 선택 시
원본의 합의 사항 목록을 AskUserQuestion 옵션으로 제시:
```yaml
questions:
  - header: "재검토 선택"
    question: "재검토할 합의 항목을 선택해주세요"
    options:
      # 원본 합의 사항에서 최대 4개 동적 생성
      - label: "[합의 항목 1]"
        description: "이 항목을 다른 관점에서 재논의"
      - label: "[합의 항목 2]"
        description: "이 항목을 다른 관점에서 재논의"
    multiSelect: false
```

#### "새 관련 주제" 선택 시
- 사용자가 직접 입력한 주제를 후속 토론 주제로 사용

---

## 3단계: 토론 설정

### 3-1. 조합 프리셋 선택 (목적 중심)

#### 후속 토론 모드
```yaml
questions:
  - header: "조합"
    question: "토론 목적에 맞는 조합을 선택해주세요"
    options:
      - label: "이전 구성 재사용 (권장)"
        description: "원본 토론과 동일한 토론자 구성 사용"
      - label: "balanced - 균형 토론"
        description: "낙관론자 + 비관론자 + 현실주의자"
      - label: "innovation - 혁신 검토"
        description: "혁신가 + 보수주의자 + 분석가"
      - label: "critical - 비판적 분석"
        description: "분석가 + 회의론자 + 비관론자"
    multiSelect: false
```

"이전 구성 재사용" 선택 시:
- 원본 토론 결과에서 참여자 목록을 파싱하여 동일 구성 적용
- 인원 선택 단계 생략

#### 새 토론 모드
```yaml
questions:
  - header: "조합"
    question: "토론 목적에 맞는 조합을 선택해주세요"
    options:
      - label: "balanced - 균형 토론 (권장)"
        description: "낙관론자 + 비관론자 + 현실주의자"
      - label: "innovation - 혁신 검토"
        description: "혁신가 + 보수주의자 + 분석가"
      - label: "critical - 비판적 분석"
        description: "분석가 + 회의론자 + 비관론자"
      - label: "risk - 리스크 평가"
        description: "현실주의자 + 비관론자 + 보수주의자"
    multiSelect: false
```

> `opportunity` 프리셋(낙관+혁신+옹호)은 사용자가 "Other"로 직접 입력하여 선택할 수 있습니다.

### 3-2. 참여 인원 선택 (이전 구성 재사용이 아닌 경우)
```yaml
questions:
  - header: "인원"
    question: "참여 인원을 선택해주세요"
    options:
      - label: "3명 (권장)"
        description: "핵심 인원으로 빠른 합의 도출"
      - label: "5명"
        description: "다양한 관점의 균형"
      - label: "7명"
        description: "깊이 있는 다각도 분석"
    multiSelect: false
```

### 조합 프리셋 구성

인원 수에 따라 핵심 3명 + 보조 인원 자동 추가:

| 조합명 | 3명 (핵심) | 5명 (+2) | 7명 (+4) |
|--------|-----------|----------|----------|
| `balanced` | 낙관+비관+현실 | +분석+회의 | +혁신+보수 |
| `innovation` | 혁신+보수+분석 | +낙관+회의 | +현실+옹호 |
| `critical` | 분석+회의+비관 | +현실+보수 | +옹호+낙관 |
| `risk` | 현실+비관+보수 | +분석+회의 | +옹호+낙관 |
| `opportunity` | 낙관+혁신+옹호 | +분석+현실 | +회의+보수 |

상세 구성은 `references/personalities.md` 참조

---

## 4단계: 토론자 프로필 준비

### 이름 자동 생성 규칙
personality → 한글명으로 자동 변환:

| personality | 한글명 | 이모지 |
|-------------|--------|--------|
| optimist | 낙관론자 | 😊 |
| pessimist | 비관론자 | 😟 |
| realist | 현실주의자 | 🎯 |
| innovator | 혁신가 | 💡 |
| conservative | 보수주의자 | 🛡️ |
| analyst | 분석가 | 🔬 |
| advocate | 옹호자 | 🙋 |
| skeptic | 회의론자 | 🤔 |

### 토론자 캐릭터 설정
`references/personalities.md`를 읽어 각 토론자의 성격 특성(핵심 특성, 발언 스타일, 관점)을 확인합니다.
이 정보는 5단계에서 각 서브에이전트의 Task prompt에 포함됩니다.

---

## 5단계: 토론 진행 (서브에이전트 기반)

> **핵심 원칙**: 각 토론자는 `debater` 서브에이전트로 독립된 컨텍스트에서 실행됩니다.
> 중재자(메인 대화)만이 토론자 간 정보를 중계하며, 이를 통해 **의견 다양성**을 보장하고 **컨텍스트 오염**을 방지합니다.

### Phase 1: 독립 리서치 (병렬 실행)

모든 토론자를 Task 도구로 **동시에 병렬 실행**하여 각자 독립적으로 주제를 조사합니다.

#### Task 호출 사양

각 토론자마다 Task 도구를 호출합니다:

| 파라미터 | 값 |
|---------|---|
| **subagent_type** | `"debater"` |
| **description** | `"{한글명} 리서치"` |
| **prompt** | 아래 리서치 프롬프트 템플릿 |

**⚡ 중요: 모든 토론자의 Task를 단일 메시지에서 동시에 호출하세요.**

#### 리서치 프롬프트 템플릿

```
[리서치]

## 당신의 역할
- **성격**: {한글명} {이모지}
- **핵심 특성**: {personalities.md에서 해당 성격의 핵심 특성}
- **발언 스타일**: {personalities.md에서 해당 성격의 발언 스타일}
- **관점**: {personalities.md에서 해당 성격의 관점}

## 토론 주제
{topic}

## 임무
1. WebSearch로 토론 주제 관련 정보를 독립적으로 조사하세요
2. 당신의 성격 관점에서 특히 관련 있는 자료를 중점 검색하세요
3. 조사 결과와 성격 특성을 종합하여 초기 입장을 정리하세요
4. 결과는 시스템 프롬프트에 정의된 리서치 결과 형식에 맞춰 반환하세요
```

후속 토론 모드인 경우, 프롬프트에 아래 섹션을 추가합니다:

```
## 📋 이전 토론 맥락
- **원본 주제**: {원본 주제}
- **합의 사항**: {합의 항목들}
- **미합의 사항**: {미합의 항목들}
- **후속 초점**: {후속 토론 초점}

위 맥락을 참고하여 후속 토론 주제에 대해 조사하세요.
```

#### 리서치 결과 수집 및 출력

모든 서브에이전트 완료 후:
1. 각 토론자의 리서치 결과와 초기 입장을 수집합니다
2. **각 토론자의 에이전트 ID를 기록합니다** — Task 도구의 반환 결과에 포함된 `agentId`를 추출하여 저장 (Phase 2의 resume 파라미터에 사용)
3. 사용자에게 요약을 출력합니다:

```
🔍 **독립 리서치 완료**

{이모지} **{한글명}**: {초기 입장 핵심 1문장}
{이모지} **{한글명}**: {초기 입장 핵심 1문장}
{이모지} **{한글명}**: {초기 입장 핵심 1문장}
```

### Phase 2: 토론 라운드 (resume 기반)

#### 중재자 오프닝

##### 새 토론 모드

```
🎙️ **[중재자]**
"토론을 시작하겠습니다. 주제는 '{토론 주제}'입니다.
각 토론자가 독립적으로 리서치를 완료했습니다. 이제 본격적인 토론을 진행합니다."
```

##### 후속 토론 모드

```
🎙️ **[중재자]**
"이전 토론 '{원본 토론 주제}'의 후속 토론을 시작하겠습니다.

📋 **이전 토론 요약:**
- 합의 사항: {합의 항목 요약}
- 미합의 사항: {미합의 항목 요약}

이번 토론에서는 '{후속 토론 초점}'에 대해 집중적으로 논의하겠습니다."
```

#### 라운드 진행

각 라운드마다 다음 절차를 반복합니다:

**1) 라운드 시작 선언**

```
🎙️ **[중재자]**
"제{N}라운드를 시작하겠습니다. {라운드 논점 또는 방향}"
```

**2) 토론자 발언 수집 (병렬 resume)**

모든 토론자를 Task 도구로 **동시에 resume**합니다:

| 파라미터 | 값 |
|---------|---|
| **subagent_type** | `"debater"` |
| **resume** | Phase 1에서 기록한 해당 토론자의 에이전트 ID |
| **description** | `"{한글명} 라운드 {N}"` |
| **prompt** | 아래 라운드별 프롬프트 |

##### 라운드 1 프롬프트

```
[토론] 라운드 1

## 다른 토론자들의 초기 입장 (중재자 요약)
- {한글명A}: {초기 입장 2~3줄 요약}
- {한글명B}: {초기 입장 2~3줄 요약}
- {한글명C}: {초기 입장 2~3줄 요약}

## 당신의 발언
다른 토론자의 입장을 참고하되, 당신의 리서치와 성격에 기반하여 **독립적으로** 의견을 제시하세요.
동의/반대 논점과 그 근거를 명확히 밝히세요.
```

##### 라운드 2+ 프롬프트

```
[토론] 라운드 {N}

## 라운드 {N-1} 요약 (중재자)
- {한글명A}: {핵심 주장 요약}
- {한글명B}: {핵심 주장 요약}
- {한글명C}: {핵심 주장 요약}

합의된 점: {있다면}
남은 쟁점: {남은 쟁점}

## 당신의 발언
- 이전 논의를 참고하여 새로운 관점이나 반론을 제시하세요
- 기존 입장을 변경할 근거가 있다면 변경해도 됩니다
- 합의할 수 있는 부분은 명시적으로 동의를 표현하세요
```

**⚡ 중요: 모든 토론자의 resume Task를 단일 메시지에서 동시에 호출하세요.**

**3) 발언 출력**

모든 서브에이전트 완료 후, 수집된 발언을 사용자에게 출력합니다:

```
👤 **{한글명} {이모지}**
"{발언 내용}"

👤 **{한글명} {이모지}**
"{발언 내용}"

👤 **{한글명} {이모지}**
"{발언 내용}"
```

**4) 라운드 요약**

중재자가 해당 라운드를 요약합니다:

```
🎙️ **[중재자]** - 라운드 {N} 요약
• 합의점: ...
• 쟁점: ...
• 다음 방향: ...
```

이 요약은 다음 라운드의 resume 프롬프트에 포함됩니다.

#### 서브에이전트 실패 처리
토론자 서브에이전트 실행이 실패할 경우 (타임아웃, 오류 등):
- 해당 토론자의 이전 라운드 입장을 유지합니다
- 중재자가 "**{한글명}**: (이전 입장 유지)" 로 표시하고 토론을 계속 진행합니다
- 연속 2회 이상 실패 시 해당 토론자를 제외하고 나머지 토론자로 진행합니다

#### 자동 진행 규칙
- **전반부** (라운드 1 ~ max_rounds÷2): 자동 진행
- **후반부** (절반 이후): 라운드마다 사용자 확인

기본 max_rounds: 7
- 라운드 1~3: 자동 진행
- 라운드 4~7: 사용자 확인

후반부 확인:
```yaml
questions:
  - header: "진행"
    question: "토론을 계속할까요?"
    options:
      - label: "계속 진행"
        description: "다음 라운드로"
      - label: "여기서 종료"
        description: "현재까지 내용으로 결론"
      - label: "논점 지정"
        description: "특정 논점에 집중"
    multiSelect: false
```

---

## 6단계: 종료 판단

다음 중 하나 충족 시 종료:
1. **합의 도달**: 핵심 논점에 과반수 합의
2. **논의 포화**: 3라운드 연속 새 논점 없음
3. **최대 라운드**: max_rounds 도달 (기본값: 7)

종료 시 중재자가 최종 정리:

```
🎙️ **[중재자]** - 토론 종료
"토론을 마무리하겠습니다.

📊 **최종 결과:**
- 총 {N}라운드 진행
- 종료 사유: {종료 사유}

✅ **합의 사항**: ...
❌ **미합의 사항**: ...
💡 **핵심 인사이트**: ...
```

---

## 7단계: 결과 저장

### 새 토론 모드 → 새 파일 생성

파일명: `토론결과_YYYYMMDD_[토픽요약].md`
- 토픽요약: 토론 주제를 2~4단어로 압축, **띄어쓰기 없이** 붙여 씀 (예: "AI도입장단점", "재택근무확대", "MVP계획")

Write 도구로 파일 생성:

```markdown
# Agora 토론 결과: [토픽 제목]

## 토론 주제

### 기본 정보
- **주제**: [토론 주제]
- **최초 토론**: [YYYY-MM-DD HH:mm] | [참여자 목록] | [종료 사유]

> **부가정보 (해당 시)**: 토론 대상 코드 현황, 시나리오 배경 등 토론 맥락을 이해하는 데 필요한 정보가 있으면 기본 정보 아래에 `### [제목]` 서브섹션으로 추가한다.

### 토론 이력
| 회차 | 일시 | 초점 | 참여자 | 라운드 | 종료 사유 |
|------|------|------|--------|--------|-----------|
| 최초 | [YYYY-MM-DD HH:mm] | (전체 주제) | [참여자 목록] | [N]회 | [종료 사유] |

---

## 결론

### 합의된 사항
1. [항목]

### 미합의 사항
1. [항목]

### 핵심 인사이트
- [인사이트]

### 추가 검토 권장 사항
- [권장 사항]

---

## 주요 논쟁

### [논쟁 주제]
- **찬성 측**: [요약] ([토론자명])
- **반대 측**: [요약] ([토론자명])
- **현재 상태**: [합의 / 미합의]
```

#### 주요 논쟁 작성 규칙
- 토론에서 나온 각 논쟁마다 `### [논쟁 주제]` 블록 생성
- **찬성 측** / **반대 측**: 핵심 논거 요약 + 발언자 명시
- **현재 상태**: `합의` 또는 `미합의`로 기록

### 후속 토론 모드 → 원본 파일 in-place Edit

원본 토론 결과 파일의 각 섹션을 Edit 도구로 직접 수정합니다.
상세 절차는 `references/followup-edit-procedure.md`를 참조하세요.

**요약**: 7단계 Edit 절차로 토론 이력, 합의/미합의 사항, 인사이트, 권장 사항, 논쟁 블록을 순차 업데이트합니다. 각 변경에 `[후속#N]` 태그를 부여하여 추적합니다.

---

## 예시 호출

```
/agora-debate:debate topic="AI 도입의 장단점"
/agora-debate:debate result="토론결과_20260205_MVP계획.md"
/agora-debate:debate
```
